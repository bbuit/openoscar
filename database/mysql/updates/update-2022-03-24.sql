UPDATE `eform` SET `subject`='Rich Text Letter Generator v2.2',`form_date`='2022-03-04',`form_time`='00:00:00',`form_html`=
    '<html>\n<head>\n<meta http-equiv="content-type" content="text/html; charset=UTF-8">\n<!--V2.2 Mar 4, 2022 -->\n<!-- Author PHC -->\n<title>Rich Text Letter</title>\n\n<style type="text/css">\n body { font-family: Arial; }\n.butn {width: 140px;}\n</style>\n<style>\n.doc {\n	color:blue;\n	font-size:10px;\n}\n.lab {\n	color:#CC0099;\n	font-size:10px;\n}\n.hrm {\n	color:red;\n	font-size:10px;\n}\n.eform {\n	color: green;\n	font-size:10px;\n}\n.chevron {\n	cursor: pointer;\n	font-weight: bold;\n	font-size: 14px;\n	-webkit-transform: rotate(180deg);\n	display: inline-block;	\n}\n.hide {\n	display: none;\n}\n.editControlButton span{\n    position: relative;\n	display: inline-block;\n	padding: 6px;\n}\n.editControlButton i {\n	padding: 6px;\n	color: #757575;\n}\n.editControlButton i:hover {\n    background-color: lightgrey;\n	color: black;\n}\n</style>\n\n<style type="text/css" media="print">\n.DoNotPrint {\n    display: none;\n}\n</style>\n\n<script language="javascript">\n// GLOBALS\nvar needToConfirm = false;\nvar ImgArray = [];\n</script>\n\n<script src="https://code.jquery.com/jquery-1.12.4.min.js"   integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>\n\n<link href="../css/jquery.ui.colorPicker.css" rel="stylesheet" type="text/css" />\n<script src="../js/jquery-ui-1.8.18.custom.min.js" type="text/javascript"></script>\n<script src="../js/jquery.ui.colorPicker.min.js" type="text/javascript"></script>\n<script language="javascript" type="text/javascript" src="${oscar_javascript_path}eforms/APCache.js"></script>\n<script language="javascript" type="text/javascript" src="${oscar_javascript_path}eforms/imageControl.js"></script>\n<script language="javascript" type="text/javascript" src="${oscar_javascript_path}eforms/faxControl.js"></script>\n<script language="javascript" type="text/javascript" src="${oscar_javascript_path}eforms/signatureControl.jsp"></script>\n<script language="javascript" type="text/javascript" src="${oscar_javascript_path}eforms/printControl.js"></script>\n\n\n<script language="javascript" type="text/javascript" src="${oscar_javascript_path}eforms/editControl2.js.jsp"></script>\n<script src=\'../eform/displayImage.do?imagefile=stamps.js\'></script>\n<link rel="stylesheet" href="../css/font-awesome.min.css">\n\n\n<script language="javascript">\n//keypress events trigger dirty flag for the iFrame and the subject line\ndocument.onkeyup=setDirtyFlag\n\nfunction setDirtyFlag() {\n	needToConfirm = true; \n}\n\nfunction releaseDirtyFlag() {\n	needToConfirm = false; //Call this function if dosent requires an alert.\n	//this could be called when save button is clicked\n}\n\nwindow.onbeforeunload = confirmExit;\n\nfunction confirmExit() {\n	if (needToConfirm){\n	return "You have attempted to leave this page. If you have made any changes without clicking the Submit button, your changes will be lost. Are you sure you want to exit this page?";\n	}\n}\n\nvar loads=true;\n\nfunction saveRTL() {\n	needToConfirm=false;\n	var theRTL=editControlContents(\'edit\');\n	var myNewString = theRTL.replace(/"/g, \'&quot;\');\n	myNewString = theRTL.replace(/</g, \'&lt;\');\n	myNewString = theRTL.replace(/>/g, \'&gt;\');\n	document.getElementById(\'Letter\').value=myNewString.replace(/\'/g, "&#39;");\n//  alternate approach to escape dangerous characters albeit less human readable, and needs to be unencoded\n//	document.getElementById(\'Letter\').value=encodeURIComponent(theRTL);	\n}\n\nfunction maximize() {\n    var width=900; //180+cfg_width;\n	window.resizeTo(width,1160) ; // width, height\n	loads=false;\n}\n\n<!-- CODE FOR PULLING MEASUREMENTS  -->\nvar depth=5;\n\n	function labgrid(){\n	//---------Paste lab grid-----------------------------------------------------------\n	doHtml("<font size=\'3\'><b>Lab testing summary:</font></b><p></p")  //header\n	var LabName = ["HB", "EGFR", "SCR", "A1C", "FBS", "BG", "GT2", "APOB", "TCHL", "LDLC", "LDL", "HDL", "TCHD", "TG", "ACR", "NA", "Kpl", "CA", "PH", "MG", "TSH", "PSA", "PTH", "AST", "ALT", "CRP", "FOBT", "FITQ", "FIT", "HPSE", "HPSG", "HPBT", "HPYL", "INR", "URIC"]\n	for (i = 0; i < LabName.length; i++) {\n	   getMeasures(LabName[i], depth)\n	}\n	}\n\n	function labgrid2(){\n	//---------Paste Vitals grid-----------------------------------------------------------\n	doHtml("<font size=\'3\'><b>Vitals summary:</font></b><p></p")  //header\n	var LabName = ["BP","WT","HT","BMI"]\n	for (i = 0; i < LabName.length; i++) {\n	   getMeasures(LabName[i], depth)\n	}\n	}\n\n	/*add eform attach*/\n	function popupEformUpload() {\n		var fid,demographic_no= "";\n		fid = gup("fid");\n		demographic_no= gup("demographic_no");\n		//popup(\'../eform/attachEform.jsp?demo=\'+demographic_no+\'&requestId=\'+fid); \n		popup(\'../eform/attachEform.jsp?demo=\'+demographic_no); \n		return false;\n	}\n	\n	function updateAttached() {\n	    var t = setTimeout(\'fetchAttached()\', 2000);\n	}\n	function fetchAttached() {\n	    var updateElem = \'tdAttachedDocs\';\n		var fid,demographic_no= "";\n		fid = gup("fid");\n		//fid=\'86\';\n		demographic_no= gup("demographic_no");\n		var params = "demo="+demographic_no+"&requestId="+fid;\n		var fdid = \'${fdid}\';\n        console.log(params);\n	//	alert(demographic_no);\n		//alert(params);\n		params = "requestId=" + fdid;\n		var url = "../eform/displayAttachedFiles.jsp";\n		\n		$.ajax({\n			url : url,\n			data:params,\n			type:\'get\',  \n			success :function(request) {\n				//alert(request.responseText);\n				$("#tdAttachedDocs").html(request);\n				// $(updateElem).innerHTML = request;\n			},\n			error:function(request) {\n				$(updateElem).innerHTML = "<h3>Error: " + + request.status + "</h3>";\n			}\n		});\n	}\n</script>\n\n<!-- START OF EDITCONTROL CODE --> \n<script language="javascript">\n	//put any of the optional configuration variables that you want here\n	cfg_width = 720; //editor control width in pixels\n	cfg_height = 500; //editor control height in pixels\n	cfg_editorname = \'edit\'; //the handle for the editor                  \n	cfg_isrc = \'../eform/displayImage.do?imagefile=\'; //location of the button icon files\n	cfg_filesrc = \'../eform/displayImage.do?imagefile=\'; //location of the html files\n	cfg_template = \'blank.rtl\'; //default style and content template\n	cfg_formattemplate = \'<option value=""> loading... </option></select>\';\n    cfg_layout = \'<table style="background-color:  #E1E1E1; width:\'+cfg_width+\'px"><tr id=control1><td align=center>\\\n[bold][italic][underlined][strike][subscript][superscript]|[left][center][full][right]|[unordered][ordered][rule][undo][redo]|[indent][outdent][select-all][clean]\\\n</td></tr><tr id=control2><td align=center>\\\n[heading1][table][text-colour][hilight]|[image][link][attach][new-page]|[clock][date][cut][copy][delete][help]|[edit][export]\\\n</td></tr><tr id=control3><td align=center>[select-block][select-face][select-size][select-template]\\\n</td></tr></table>[edit-area]\'; \n	//cfg_layout = \'[all]\';             //adjust the format of the buttons here\n	insertEditControl(); // Initialise the edit control and sets it at this point in the webpage\n</script>\n<!-- END OF EDITCONTROL CODE -->\n\n<script>\n// example of non standard database pulls to create cache that can be pulled from a button\nfunction getAgeGender() {\n	// set the HTML contents of the letterhead\n	var ageGender = cache.get(\'age\')\n			+ \' year old  \'\n			+ cache.get(\'gender\');\n	return ageGender;\n}\n\n	cache.addMapping({\n		name: "ageGender", \n		values: ["_age","gender","age","sex","ageComplex"], \n		storeInCacheHandler: function (key, value) {\n			var text = getAgeGender();\n			cache.put("ageGender", text);\n		},\n		cacheResponseHandler: function () {\n			if (checkKeyResponse(this.name)) {\n				doHtml(cache.get(this.name));\n			}\n		}\n	});\n</script>\n</head>\n\n<body bgcolor="FFFFFF" onload="Start();">\n\n<form method="post" action="" name="RichTextLetter" >\n<input type="hidden" name="WT" id="WT" oscarDB=m$WT#value>\n<textarea name="Letter" id="Letter" style="width:600px; display: none;"></textarea>\n<div class="edit-controllers" id="edit-controllers"></div>\n\n    <div class="DoNotPrint" id="control4" style="position:absolute; top:5px; left: 740px;"> <!-- left should be cfg_width +20 -->\n\n    <!-- Letter Head -->\n    <input type="button" class="butn" name="AddLetterhead" id="AddLetterhead" value="Letterhead" onclick="printKey(\'letterhead\');">\n    <br>\n    <!-- Adressee Select -->\n    <input type="text" name="referral_name" id="referral_name" onKeyup="consultantSearch(this.value)" placeholder=" lastname, firstname" autocomplete="off" onFocus="toggleTempBin(1, \'referral_name\')" onBlur="toggleTempBin(0, \'referral_name\')"  style="font-size:12px; width:140px;">\n        <div id="tempBin" onmouseover="tempBinHover(true)" onmouseout="tempBinHover(false)"style="display:none;position:absolute;padding:4px; background-color:white;border:thin solid #cccccc;z-index:999;font-size:12px;">You must enter at least 2 characters of a doctors name!</div>\n    <input type="hidden" name="consultantFilter" id="consultantFilter">\n    <textarea name="CopyTo" id="CopyTo" type="hidden" style="display:none;" ></textarea>\n    <br>\n    <input type="button" class="butn" name="AddSelected" id="AddSelected" value="Paste Selected" onclick="doHtml(getElementById(\'CopyTo\').value.replace(/(\\r\\n|\\n|\\r)/gm,\'<br>\'));console.log(getElementById(\'CopyTo\').value);">\n    <br>\n    <!-- Referring Block -->\n    <input type="button" class="butn" name="AddReferral" id="AddReferral" value="Referring Block" onclick="printKey(\'_ReferringBlock\');">\n    <br>\n    <!-- Patient Block -->\n    <input type="button" class="butn" name="label" value="Patient Label" onclick="hist=\'label\';printKey(hist);">\n    <br>\n	<input type="button" class="butn" name="Patient" value="Patient Name" onclick="printKey(\'first_last_name\');">\n    <br>\n    <input type="button" class="butn" name="PatientSex" value="Age & Gender" onclick="printKey(\'ageGender\');">\n    <br>\n    <!-- Social History -->\n    <input type="button" class="butn" name="AddSocialFamilyHistory" value="Social History" onclick="var hist=\'_SocialFamilyHistory\';printKey(hist);">\n    <br>\n    <!--  Medical History -->\n    <input type="button"  class="butn" name="AddMedicalHistory" value="Medical History" width=30 onclick="var hist=\'medical_historyS\';printKey(hist);">\n    <br>\n    <!--  Ongoing Concerns -->\n    <input type="button" class="butn" name="AddOngoingConcerns" value="Ongoing Concerns" onclick="var hist=\'ongoingconcerns\'; printKey(hist);">\n    <br>\n    <!-- Reminders -->\n    <input type="button" class="butn" name="AddReminders" value="Reminders"\n	    onclick="var hist=\'reminders\'; printKey(hist);">\n    <br>\n    <!-- Allergies -->\n    <input type="button" class="butn" name="Allergies" id="Allergies" value="Allergies" onclick="printKey(\'allergies_des\');">\n    <br>\n    <!-- Prescriptions -->\n    <input type="button" class="butn" name="Medlist" id="Medlist" value="Prescriptions"	onclick="printKey(\'druglist\');">\n    <br>\n    <!-- Other Medications -->\n    <input type="button" class="butn" name="OtherMedicationsHistory" value="Other Medications" onclick="printKey(\'other_medications_history\'); ">\n    <br>\n    <!-- Risk Factors -->\n    <input type="button" class="butn" name="RiskFactors" value="Risk Factors" onclick="printKey(\'risk_factors_ext\'); ">\n    <br>\n    <!-- Family History -->\n    <input type="button" class="butn" name="FamilyHistory" value="Family History" onclick="printKey(\'family_history\'); ">\n    <br>\n    <!-- Preventions -->  \n    <input type="button" class="butn" name="Preventions" value="Preventions" onclick="fpreventions()">\n    <br>\n\n<script>\nfunction fpreventions(){\n    var sql2pass="SELECT   \'<br>\',  prevention_type as \'<b>PREVENTIONS\',\'&#160;&#160;&#160;Date:&#160;\' as \':\', LEFT(prevention_date,10) as \'</b>\' FROM preventions  WHERE demographic_no=" + demographicNo + " AND deleted=\'0\' GROUP by prevention_type, prevention_date ";\n    $(document).ready(function () {  \n        $.ajax({  \n            url: "../oscarReport/RptByExample.do" ,\n            data: { sql: sql2pass }\n        }).then(function(data) {  \n           //alert(data)\n           var elements = $(data);\n           var found = elements.find(\'.MainTableRightColumn table table\');\n           doHtml(found.html())\n        });  \n    });\n}\n</script>\n\n    <!-- Closing Salutation -->\n    <input type="button" class="butn" name="Closing" value="Closing Salutation" onclick="printKey(\'_ClosingSalutation\');">\n    <br>\n    <!-- Signature Stamp -->\n    <input type="button" class="butn" name="stamp" value="Stamp" onclick="printKey(\'stamp\');">\n    <br>\n    <!--  Current User -->\n    <input type="button" class="butn" name="User" value="Current User" onclick="var hist=\'current_user\'; printKey(hist);">\n    <br>\n    <!-- Attending Doctor -->\n    <input type="button" class="butn" name="Doctor" value="Doctor (MRP)" onclick="var hist=\'doctor\'; printKey(hist);">\n    <br>\n    <!-- Vitals -->\n    <input type="button" class="butn" name="Vitals" value="Vitals" onclick="labgrid2()">\n    <br>\n    <!-- Common Labs -->\n    <input type="button" class="butn" name="LabGrid" value="Lab Grid" onclick="labgrid()">\n    <br>\n\n    <table style="width:140px">\n        <tbody>\n            <tr>\n                <td style="text-align: center" id="tdAttachedLabel" >Attached Files:</td>\n            </tr>\n            <tr>\n	            <td id="tdAttachedDocs" > <!-- important as this is where the results get put--> </td>\n            </tr>\n            <tr id="trAttachedDocs" >\n	            <td style="text-align: center">Legend<br>\n	            <span class="doc">Blue - Documents</span><br>\n	            <span class="lab">Purple - Labs</span><br>\n	            <span class="hrm">Red - Hrm</span><br>\n	            <span class="eform">Green - EForm</span>\n	            </td>\n            </tr>\n        </tbody>\n    </table>\n</div>\n\n<div class="DoNotPrint" >\n    <span id="arrow" title="expand" class="chevron" onclick="collapseFooter();">&nbsp^&nbsp;</span>\n    <input onclick="viewsource(this.checked)" type="checkbox"> HTML Source\n    <input onclick="usecss(this.checked)" type="checkbox">\n    Use CSS	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \n    Subject: <input name="subject" id="subject" size="40" type="text">		 \n\n    <table id="controls4">\n        <tr id=sig>\n            <td><div id="signatureInput">&nbsp;</div></td>\n        </tr>\n        <tr>\n            <td><div id="faxControl">&nbsp;</div></td>\n        </tr>      \n        <tr>\n            <td>\n            <input value="Submit" name="SubmitButton" type="submit" onclick="saveRTL();  document.RichTextLetter.submit()">\n            <input value="Print" name="PrintSaveButton" type="button" onclick="document.getElementById(\'edit\').contentWindow.print();saveRTL();  setTimeout(\'document.RichTextLetter.submit()\',1000);">\n            <input value="Reset" name="ResetButton" type="reset">\n            <input value="Print" name="PrintButton" type="button" onclick="document.getElementById(\'edit\').contentWindow.print();">\n            </td>\n        </tr>\n    </table>\n</div>\n</form>\n</body>\n</html>'
WHERE `form_name` LIKE "%Rich Text Letter%" AND `form_time` IN ('00:00:00','16:00:00') AND DATE(`form_date`) < '2021-12-02' ;